!function(t){var e={secondly:1e3,minutely:6e4,quarterly:9e5,hourly:36e5,daily:864e5,weekly:6048e5},i=function(t){if(!i.prototype.isPrototypeOf(this))return new i(t);this.options=t||{},this.track=this.options.history||[],this.rules=[];for(var n in e)e.hasOwnProperty(n)&&n in this.options&&this[n](this.options[n])};i.prototype.getNextDelay=function(){return this._runRules().delay},i.prototype.push=function(t,e){var i=this.getNextDelay(),n=this;if(!this.rules.length)throw{name:"RuleError",message:"there are no defined rules"};return"function"==typeof e&&e(i)===!1?!1:(this.track.push(Date.now()+i),{delay:i,timer:setTimeout(function(){"function"==typeof n.options.onCall&&n.options.onCall(i),t()},i)})},i.prototype._runRules=function(){for(var t=Date.now(),e={delay:0},i=0,n=this.rules.length;n>i;i++){var r=this.rules[i](t,this.track);e.delay<r.delay&&(e.delay=r.delay),(!("spliceIdx"in e)||e.spliceIdx>r.spliceIdx)&&(e.spliceIdx=r.spliceIdx)}return"spliceIdx"in e&&e.spliceIdx>0&&("function"==typeof this.options.onClear&&this.options.onClear(this.track[e.spliceIdx]),this.track.splice(0,e.spliceIdx)),e},i.prototype._getInsertPosition=function(t){for(var e=0,i=this.track.length;i>e;){var n=e+i>>>1;this.track[n]<t?e=n+1:i=n}return e},i.prototype.within=function(t,e){var i=this;if(e%1!==0||1>e)throw{name:"MaxcallsRangeError",message:"maxcalls must be above 0 and an integer"};return this.register(function(n,r){var o=n-t,s=i._getInsertPosition(o),l=r.length-s,a=l>=e?r[s+(l-e)]+t-n:0;return{delay:a,spliceIdx:s}}),this};for(var n in e)e.hasOwnProperty(n)&&!function(t){i.prototype[t]=function(i){return this.within(e[t],i)}}(n);i.prototype.register=function(t){return this.rules.push(t),this},"undefined"!=typeof module&&module.exports?module.exports=i:"undefined"!=typeof define&&define.amd?define([],function(){return i}):t.limits=i}(this);